<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>admin</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    </head>
    <body>
        <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
        <script>
            CMS.registerPreviewStyle('/css/styles.css');
            var BodyPreview = createClass({
                render: function() {
                    var entry = this.props.entry;
                    return h('main', {}, this.props.widgetFor('body'));
                }
            });
            CMS.registerPreviewTemplate('custompages', BodyPreview);
            CMS.registerPreviewTemplate('home', BodyPreview);
            CMS.registerPreviewTemplate('contact', BodyPreview);
            CMS.registerPreviewTemplate('404', BodyPreview);
            CMS.registerEditorComponent({
                id: "youtube",
                label: "Youtube",
                fields: [{name: 'id', label: 'Youtube Video ID', widget: 'string'}],
                pattern: /^{% youtube "(\S+)" %}$/,
                fromBlock: function(match) {
                    return {
                        id: match[1]
                    };
                },
                toBlock: function(obj) {
                    return '{% youtube "' + obj.id + '" %}';
                },
                toPreview: function(obj) {
                    return (
                        '<img src="http://img.youtube.com/vi/' + obj.id + '/maxresdefault.jpg" alt="Youtube Video"/>'
                    );
                }
            });
            CMS.registerEditorComponent({
                id: "pancake",
                label: "Pancake",
                fields: [{
                    name: 'pancake',
                    label: 'Pancake',
                    widget: 'list',
                    fields: [{name: 'slice', label: 'Slice', widget: 'markdown' }]
                }],
                pattern: /{% pancake %}(.*){% endpancake %}/,
                fromBlock: function(match) {
                    console.log('fromBlock');
                    console.log(match);
                    //var contents = match[1];
                    //var slices = contents.match(/{% slice %}(.*){% endslice %}/g)
                    return {
                        //pancake: match[1]
                    };
                },
                toBlock: function(obj) {
                    let code = '{% pancake %}';
                    if (obj.pancake) {
                        obj.pancake.forEach((pancake) => {
                            code = code + '{% slice %}';
                            code = code + pancake.slice;
                            code = code + '{% endslice %}';
                        });
                    }
                    code = code + '{% endpancake %}';
                    return code;
                },
                toPreview: function(obj) {
                    console.log('toPreview');
                    console.log(obj);
                    return (
                        'no preview'
                    );
                }
            });
        </script>
    </body>
</html>
